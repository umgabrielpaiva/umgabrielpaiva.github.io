<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helena Home&Style</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="icone.png">
    <link rel="stylesheet" href="siteprincipal.css">

    <!-- Estilos específicos para siteAdmin -->
    <link rel="stylesheet" href="siteadm.css">

    <!-- Estilos específicos para siteCliente -->
    <link rel="stylesheet" href="sitecliente.css">

    <!-- Firebase scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-database.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyB3uGa04ikZGC9j75RwP7NPplrYFRHEnpg",
            authDomain: "helenahomestyle-e84cb.firebaseapp.com",
            projectId: "helenahomestyle-e84cb",
            storageBucket: "helenahomestyle-e84cb.appspot.com",
            messagingSenderId: "1061462141336",
            appId: "1:1061462141336:web:f0e6039cccf52c9fa423ed",
            measurementId: "G-PK525KX89C"
        };

        // Inicialize o Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Referência para o banco de dados do Firebase
        const database = firebase.database();
    </script>

</head>
<body>

<!-- sitePrincipal -->
<div id="sitePrincipal">
    <img class="logo" src="logo.jpg" alt="">
    <div class="login-container">
        <input class="email" type="email" id="emailInput" placeholder="Digite seu e-mail">
        <button class="botaop" onclick="entrar()">Entrar</button>
        <button class="botaop"  onclick="mostrarSiteCliente()">Sou um Cliente</button>
    </div>
</div>

<!-- siteAdmin -->
<div id="siteAdmin" class="hidden">
    <img class="logo" src="logo.jpg" alt="">
    <div class="admin-container">
        <h2>Adicionar Produto</h2>
        <h3> Digite o Nome do Produto</h3>
        <input type="text" id="productName" placeholder="Nome do Produto"><br>
        <h3> Cole a URL da Imagem</h3>
        <input type="text" id="productImage" placeholder="URL da Imagem"><br>
        <h3> Cole o Link do Produto</h3>
        <input type="text" id="productLink" placeholder="Link do Produto"><br>
        <button onclick="addProduct()">Enviar</button>
    </div>
    <div id="products-list-container-admin" class="cards-container">
        <div id="products-list-admin"></div>
    </div>
    <button class="botaov" onclick="voltar()">Voltar</button> <!-- Botão Voltar adicionado -->
</div>

<!-- siteCliente -->
<div id="siteCliente" class="hidden">
    <img class="logo" src="logo.jpg" alt="">
    <h1> Meus Produtos Favoritos</h1>
    <div id="products-list-container-cliente" class="cards-container">
        <div id="products-list-cliente"></div>
    </div>
    <button class="botaov" onclick="voltar()">Voltar</button> <!-- Botão Voltar adicionado -->
</div>

<!-- Scripts -->
<script>
    // Função para exibir o site do Admin e ocultar os outros
    function entrar() {
        document.getElementById('sitePrincipal').classList.add('hidden');
        document.getElementById('siteAdmin').classList.remove('hidden');
        document.getElementById('siteCliente').classList.add('hidden');
        fetchProductsAndUpdateUI(); // Atualiza a lista de produtos no admin ao entrar
    }

    // Função para exibir o site do Cliente e ocultar os outros
    function mostrarSiteCliente() {
        document.getElementById('sitePrincipal').classList.add('hidden');
        document.getElementById('siteAdmin').classList.add('hidden');
        document.getElementById('siteCliente').classList.remove('hidden');
        fetchProductsAndUpdateUI(); // Atualiza a lista de produtos no cliente ao mostrar
    }

    // Função para voltar à página principal (sitePrincipal)
    function voltar() {
        document.getElementById('sitePrincipal').classList.remove('hidden');
        document.getElementById('siteAdmin').classList.add('hidden');
        document.getElementById('siteCliente').classList.add('hidden');
    }

    // Função para adicionar um produto
    function addProduct() {
        const productName = document.getElementById('productName').value;
        const productImage = document.getElementById('productImage').value;
        const productLink = document.getElementById('productLink').value;

        const newProduct = { name: productName, image: productImage, link: productLink };

        // Adicionar produto ao localStorage
        const storedProducts = JSON.parse(localStorage.getItem('products')) || [];
        storedProducts.push(newProduct);
        localStorage.setItem('products', JSON.stringify(storedProducts));

        // Adicionar produto ao Firebase
        addProductToFirebase(productName, productImage, productLink)
            .then(() => {
                // Atualiza a lista de produtos no admin e no cliente
                fetchProductsAndUpdateUI();

                // Limpar os campos de entrada após adicionar o produto
                document.getElementById('productName').value = '';
                document.getElementById('productImage').value = '';
                document.getElementById('productLink').value = '';
            })
            .catch(error => {
                console.error('Erro ao adicionar produto no Firebase:', error);
            });
    }

    // Função para excluir um produto
    function deleteProduct(productName, source) {
        let storedProducts = JSON.parse(localStorage.getItem('products')) || [];
        // Encontrar o índice do produto pelo nome
        const index = storedProducts.findIndex(product => product.name === productName);
        if (index !== -1) {
            storedProducts.splice(index, 1); // Remove o produto da lista
            localStorage.setItem('products', JSON.stringify(storedProducts)); // Atualiza o armazenamento local
            fetchProductsAndUpdateUI(); // Atualiza a lista de produtos no admin e no cliente
        }
    }

    // Função para redirecionar para o link do produto
    function redirectToProduct(productLink) {
        window.open(productLink, '_blank'); // Abre o link em uma nova aba
    }

    // Função para criar elemento de produto
    function createProductElement(product) {
        const productElement = document.createElement('div');
        productElement.classList.add('product-item');
        productElement.classList.add('card');
        productElement.innerHTML = `
            <div class="product-info">
                <h3>${product.name}</h3>
            </div>
            <div class="product-image">
                <img src="${product.image}" alt="${product.name}">
            </div>
            <button class="excluir" onclick="deleteProduct('${product.name}', 'admin')">Excluir</button>
        `;
        return productElement;
    }

    // Função para adicionar produtos ao admin UI
    function addProductsToAdminUI(products) {
        const productsListContainer = document.getElementById('products-list-admin');
        productsListContainer.innerHTML = '';

        if (products) {
            Object.keys(products).forEach(key => {
                const product = products[key];
                const productElement = createProductElement(product);
                productsListContainer.appendChild(productElement);
            });
        }
    }

    // Função para adicionar produtos ao cliente UI
    function addProductsToClientUI(products) {
        const productsListContainer = document.getElementById('products-list-cliente');
        productsListContainer.innerHTML = '';

        if (products) {
            Object.keys(products).forEach(key => {
                const product = products[key];
                const productElement = createProductElement(product);
                productsListContainer.appendChild(productElement);
            });
        }
    }

    // Função para obter produtos do Firebase e atualizar na UI do admin e cliente
    function fetchProductsAndUpdateUI() {
        const productsRef = database.ref('products');

        // Para admin
        productsRef.once('value', (snapshot) => {
            const storedProducts = snapshot.val();
            addProductsToAdminUI(storedProducts);
        });

        // Para cliente
        productsRef.once('value', (snapshot) => {
            const storedProducts = snapshot.val();
            addProductsToClientUI(storedProducts);
        });
    }

    // Ao carregar a página, inicializa a lista de produtos no admin e cliente
    window.addEventListener('load', function() {
        fetchProductsAndUpdateUI();
    });
</script>

</body>
</html>
